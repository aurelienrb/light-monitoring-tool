<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<title>Light Monitor</title>
	<link rel="shortcut icon" href="" />
	<link href="css/style.css" rel="stylesheet" type="text/css">
	<!--[if lte IE 8]><script language="javascript" type="text/javascript" src="../../excanvas.min.js"></script><![endif]-->
	<script language="javascript" type="text/javascript" src="js/jquery.js"></script>
	<script language="javascript" type="text/javascript" src="js/jquery.flot.js"></script>
	<script type="text/javascript">
	$(function() {
		var totalPoints = 60;

		// init Plot
		var plot = $.plot("#placeholder", [
			{ label: "CPU", data: [] }
		], {
			series: {
				lines: { show: true },
				points: { show: false },
				shadowSize: 0	// Drawing is faster without shadows
			},
			yaxis: {
				min: 0,
				max: 100
			},
			xaxis: {
				min: 0,
				max: totalPoints
			},
			grid: {
				backgroundColor: { colors: [ "#fff", "#eee" ] },
				borderWidth: {
					top: 1,
					right: 1,
					bottom: 2,
					left: 2
				}
			}
		});

		function processJsonData(jsonData) {
			var res = [];
			try {
				//var data = jQuery.parseJSON(jsonData);
				if (jsonData && jsonData.cpu) {
					var data = jsonData.cpu;
					for (var i = 0; i < data.length; ++i) {
						res.push([i, data[i] + i])
					}
				}
			}
			catch (err) {
				console.warn(err);
			}
			return res;
		}

		function request_data() {
			$.get("/api/cpu", function(jsonData){
				$('#status-info').html(''); // clear status msg

				var data = processJsonData(jsonData);
				plot.setData([data]);
				plot.draw(); // axes don't change so we don't need to call setupGrid()
				
				var updateInterval = 1000;
				setTimeout(request_data, updateInterval);
			});
		}

		$('#status-info').html('Fetching data...');
		request_data();
	});
	</script>
</head>
<body>
	<div id="header">
		<h2>Real-time CPU updates</h2>
	</div>

	<div id="content">
		<div class="demo-container">
			<div id="placeholder" class="demo-placeholder"></div>
		</div>
		<p id="status-info" />
	</div>
	<!--div id="footer">
		Copyright &copy; 2016
	</div-->
</body>
</html>